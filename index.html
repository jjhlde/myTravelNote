<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë§ˆì¹´ì˜¤ ê°€ì¡±ì—¬í–‰ ğŸ‡²ğŸ‡´</title>
    
    <!-- PWA ë©”íƒ€ íƒœê·¸ -->
    <meta name="theme-color" content="#4F46E5">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="ë§ˆì¹´ì˜¤ ê°€ì¡±ì—¬í–‰">
    
    <!-- ì•„ì´ì½˜ -->
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ğŸ‡²ğŸ‡´</text></svg>">
    <link rel="apple-touch-icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ğŸ‡²ğŸ‡´</text></svg>">
    
    <!-- ë§¤ë‹ˆí˜ìŠ¤íŠ¸ -->
    <link rel="manifest" href="./manifest.json">
    
    <!-- CSS íŒŒì¼ -->
    <link rel="stylesheet" href="./macau/macau.css">
</head>
<body>
    <div class="container">
        <!-- PWA ì„¤ì¹˜ ê°€ì´ë“œ íŒì—… -->
        <div class="install-guide-overlay" id="installGuideOverlay">
            <div class="install-guide-popup">
                <button class="close-btn" id="closeGuideBtn">âœ•</button>
                
                <div class="install-guide-header">
                    <div class="install-guide-icon">ğŸ“±</div>
                    <div class="install-guide-title">ì•±ìœ¼ë¡œ ì„¤ì¹˜í•˜ì„¸ìš”!</div>
                    <div class="install-guide-subtitle">
                        ë§ˆì¹´ì˜¤ ì—¬í–‰ê³„íšì„ ì–¸ì œë“ <br>
                        ë¹ ë¥´ê²Œ í™•ì¸í•  ìˆ˜ ìˆì–´ìš”
                    </div>
                </div>

                <div class="install-steps">
                    <div class="install-step">
                        <div class="step-number">1</div>
                        <div class="step-content">
                            <div class="step-text">í•˜ë‹¨ ê³µìœ  ë²„íŠ¼ í„°ì¹˜ <span class="step-icon">â¬†ï¸</span></div>
                        </div>
                    </div>
                    <div class="install-step">
                        <div class="step-number">2</div>
                        <div class="step-content">
                            <div class="step-text">"í™ˆ í™”ë©´ì— ì¶”ê°€" ì„ íƒ <span class="step-icon">â•</span></div>
                        </div>
                    </div>
                    <div class="install-step">
                        <div class="step-number">3</div>
                        <div class="step-content">
                            <div class="step-text">ì˜¤ë¥¸ìª½ ìƒë‹¨ "ì¶”ê°€" í„°ì¹˜ <span class="step-icon">âœ…</span></div>
                        </div>
                    </div>
                </div>

                <div class="install-benefit">
                    <div class="benefit-title">ğŸŒŸ ì•± ì„¤ì¹˜ í˜œíƒ</div>
                    <div class="benefit-list">
                        âœ“ ë§ˆì¹´ì˜¤ì—ì„œ ì˜¤í”„ë¼ì¸ ì‚¬ìš©<br>
                        âœ“ ë¹ ë¥¸ ì ‘ì† (3ì´ˆ â†’ 1ì´ˆ)<br>
                        âœ“ í™ˆ í™”ë©´ì—ì„œ ë°”ë¡œ ì‹¤í–‰
                    </div>
                </div>

                <div class="install-buttons">
                    <button class="btn-primary" id="installNowBtn">ì§€ê¸ˆ ì„¤ì¹˜í•˜ê¸°</button>
                    <button class="btn-secondary" id="skipInstallBtn">ë‚˜ì¤‘ì—</button>
                </div>
            </div>
        </div>
        
        <div class="header">
            <div class="header-content">
                <div class="header-main">
                    <h1>ğŸ‡²ğŸ‡´ ë§ˆì¹´ì˜¤ ê°€ì¡±ì—¬í–‰</h1>
                    <p>37ê°œì›” ë”¸ê³¼ í•¨ê»˜í•˜ëŠ” íŠ¹ë³„í•œ ì—¬í–‰</p>
                </div>
                <!-- í—¤ë” ìœ í‹¸ë¦¬í‹°ëŠ” í•˜ë‹¨ FABë¡œ ì´ë™ ì˜ˆì • -->
            </div>

            <div class="day-tabs">
                <div class="day-tab active" data-page="0">ğŸ“‹ ì •ë³´</div>
                <div class="day-tab" data-page="1">1ì¼ì°¨</div>
                <div class="day-tab" data-page="2">2ì¼ì°¨</div>
                <div class="day-tab" data-page="3">3ì¼ì°¨</div>
                <div class="day-tab" data-page="4">4ì¼ì°¨</div>
                <div class="day-tab" data-page="5">ğŸ’° ì¤€ë¹„ë¬¼</div>
            </div>
        </div>

        <div class="pages-container">
            <div class="pages-wrapper" id="pagesWrapper">
                <!-- í˜ì´ì§€ ì½˜í…ì¸ ëŠ” ë™ì ìœ¼ë¡œ ë¡œë“œë©ë‹ˆë‹¤ -->
                <div class="page" id="page-0">
                    <div class="loading">í˜ì´ì§€ ë¡œë”© ì¤‘...</div>
                </div>
                <div class="page" id="page-1">
                    <div class="loading">í˜ì´ì§€ ë¡œë”© ì¤‘...</div>
                </div>
                <div class="page" id="page-2">
                    <div class="loading">í˜ì´ì§€ ë¡œë”© ì¤‘...</div>
                </div>
                <div class="page" id="page-3">
                    <div class="loading">í˜ì´ì§€ ë¡œë”© ì¤‘...</div>
                </div>
                <div class="page" id="page-4">
                    <div class="loading">í˜ì´ì§€ ë¡œë”© ì¤‘...</div>
                </div>
                <div class="page" id="page-5">
                    <div class="loading">í˜ì´ì§€ ë¡œë”© ì¤‘...</div>
                </div>
            </div>
        </div>

        <!-- í˜ì´ì§€ ì¸ë””ì¼€ì´í„° -->
        <div class="page-indicator">
            <div class="indicator-dot active" data-page="0"></div>
            <div class="indicator-dot" data-page="1"></div>
            <div class="indicator-dot" data-page="2"></div>
            <div class="indicator-dot" data-page="3"></div>
            <div class="indicator-dot" data-page="4"></div>
            <div class="indicator-dot" data-page="5"></div>
        </div>

        <!-- ìŠ¤ì™€ì´í”„ ê°€ì´ë“œ -->
        <div class="swipe-hint" id="swipeHint">ğŸ‘ˆ ì¢Œìš°ë¡œ ìŠ¤ì™€ì´í”„í•´ì„œ ë‚ ì§œ ì´ë™ ğŸ‘‰</div>
    </div>

    <!-- ì´ë¯¸ì§€ íŒì—… ëª¨ë‹¬ -->
    <div class="image-popup-overlay" id="imagePopupOverlay">
        <div class="image-popup-content">
            <img id="popupImage" class="image-popup-img" src="" alt="">
            <button class="image-popup-close" id="popupClose">âœ•</button>
            <div class="image-popup-info">
                <div class="image-popup-title" id="popupTitle">ì—¬í–‰ ì‚¬ì§„</div>
                <div class="image-popup-description" id="popupDescription">í´ë¦­í•˜ê±°ë‚˜ ESC í‚¤ë¥¼ ëˆŒëŸ¬ ë‹«ê¸°</div>
            </div>
        </div>
    </div>

    <!-- í™˜ìœ¨ ê³„ì‚°ê¸° íŒì—… -->
    <div class="exchange-popup-overlay" id="exchangePopupOverlay">
        <div class="exchange-popup-content">
            <div class="exchange-popup-header">
                <h3>ğŸ’± í™˜ìœ¨ ê³„ì‚°ê¸°</h3>
                <button class="exchange-popup-close" id="exchangePopupClose">âœ•</button>
            </div>
            
            <div class="exchange-rate-info">
                <div class="rate-display">
                    <span class="rate-text" id="currentRate">í™˜ìœ¨ ë¡œë”© ì¤‘...</span>
                    <span class="rate-date" id="rateDate">í•œêµ­ìˆ˜ì¶œì…ì€í–‰ ì œê³µ</span>
                </div>
            </div>

            <div class="exchange-calculator">
                <div class="exchange-input-group">
                    <label for="mopInput">ë§ˆì¹´ì˜¤ íŒŒíƒ€ì¹´ (MOP)</label>
                    <div class="input-wrapper">
                        <input type="number" id="mopInput" placeholder="0" step="0.01" min="0">
                        <span class="currency-label">MOP</span>
                    </div>
                </div>

                <div class="exchange-arrow">â‡©</div>

                <div class="exchange-input-group">
                    <label for="krwOutput">í•œêµ­ ì› (KRW)</label>
                    <div class="input-wrapper">
                        <input type="text" id="krwOutput" placeholder="0" readonly>
                        <span class="currency-label">ì›</span>
                    </div>
                </div>
            </div>


            <div class="exchange-tips">
                <div class="tips-title">ğŸ’¡ í™˜ìœ¨ íŒ</div>
                <div class="tips-content">
                    â€¢ ë§ˆì¹´ì˜¤ ëŒ€ë¶€ë¶„ ìƒì ì—ì„œ í™ì½©ë‹¬ëŸ¬(HKD)ë„ ì‚¬ìš© ê°€ëŠ¥<br>
                    â€¢ ì¹´ì§€ë…¸ì—ì„œëŠ” HKDê°€ ë” ì„ í˜¸ë¨<br>
                    â€¢ í˜„ê¸ˆ í™˜ì „ë³´ë‹¤ ì¹´ë“œ ê²°ì œê°€ í™˜ìœ¨ìƒ ìœ ë¦¬
                </div>
            </div>
        </div>
    </div>

    <!-- ì˜ˆì‚° ê´€ë¦¬ íŒì—… -->
    <div class="budget-popup-overlay" id="budgetPopupOverlay">
        <div class="budget-popup-content">
            <div class="budget-popup-header">
                <h3>ğŸ’° ì˜ˆì‚° ê´€ë¦¬</h3>
                <button class="budget-popup-close" id="budgetPopupClose">âœ•</button>
            </div>

            <!-- ì˜ˆì‚° í˜„í™© -->
            <div class="budget-status" id="budgetStatus">
                <div class="budget-total">
                    <span class="budget-label">ì´ ì˜ˆì‚°</span>
                    <span class="budget-amount" id="totalBudget">ì„¤ì •ë˜ì§€ ì•ŠìŒ</span>
                </div>
                <div class="budget-remaining">
                    <span class="budget-label">ë‚¨ì€ ì˜ˆì‚°</span>
                    <span class="budget-amount" id="remainingBudget">-</span>
                </div>
                <div class="budget-daily">
                    <span class="budget-label">ì¼ì¼ ê¶Œì¥</span>
                    <span class="budget-amount" id="dailyBudget">-</span>
                </div>
            </div>

            <!-- ì˜ˆì‚° ì„¤ì • -->
            <div class="budget-setup" id="budgetSetup">
                <div class="budget-input-group">
                    <label>ì´ ì—¬í–‰ ì˜ˆì‚° (ì›)</label>
                    <input type="number" id="budgetInput" placeholder="1000000" min="0">
                </div>
                <div class="budget-dates">
                    <div class="date-input-group">
                        <label>ì—¬í–‰ ì‹œì‘ì¼</label>
                        <input type="date" id="startDateInput">
                    </div>
                    <div class="date-input-group">
                        <label>ì—¬í–‰ ì¢…ë£Œì¼</label>
                        <input type="date" id="endDateInput">
                    </div>
                </div>
                <button class="btn-primary" id="setBudgetBtn">ì˜ˆì‚° ì„¤ì •</button>
            </div>

            <!-- ì§€ì¶œ ì…ë ¥ -->
            <div class="expense-input" id="expenseInput" style="display: none;">
                <!-- ì¹´í…Œê³ ë¦¬ ì„ íƒ -->
                <div class="category-selection">
                    <label>ì§€ì¶œ ì¹´í…Œê³ ë¦¬</label>
                    <div class="category-grid" id="categoryGrid">
                        <button class="category-btn" data-category="food" data-icon="ğŸ½ï¸">
                            <span class="category-icon">ğŸ½ï¸</span>
                            <span class="category-text">ì‹ì‚¬</span>
                        </button>
                        <button class="category-btn" data-category="transport" data-icon="ğŸš—">
                            <span class="category-icon">ğŸš—</span>
                            <span class="category-text">êµí†µ</span>
                        </button>
                        <button class="category-btn" data-category="shopping" data-icon="ğŸ›ï¸">
                            <span class="category-icon">ğŸ›ï¸</span>
                            <span class="category-text">ì‡¼í•‘</span>
                        </button>
                        <button class="category-btn" data-category="attraction" data-icon="ğŸ¡">
                            <span class="category-icon">ğŸ¡</span>
                            <span class="category-text">ê´€ê´‘</span>
                        </button>
                        <button class="category-btn" data-category="accommodation" data-icon="ğŸ¨">
                            <span class="category-icon">ğŸ¨</span>
                            <span class="category-text">ìˆ™ë°•</span>
                        </button>
                        <button class="category-btn" data-category="other" data-icon="ğŸ’³">
                            <span class="category-icon">ğŸ’³</span>
                            <span class="category-text">ê¸°íƒ€</span>
                        </button>
                    </div>
                </div>

                <!-- ì§€ì¶œ ì…ë ¥ í¼ -->
                <div class="expense-form" id="expenseForm" style="display: none;">
                    <div class="selected-category" id="selectedCategory">
                        <span class="selected-icon" id="selectedIcon">ğŸ½ï¸</span>
                        <span class="selected-text" id="selectedText">ì‹ì‚¬</span>
                    </div>
                    
                    <div class="expense-inputs">
                        <div class="expense-amount-input">
                            <input type="number" id="expenseAmount" placeholder="ì§€ì¶œ ê¸ˆì•¡" min="0" step="1000">
                            <span class="currency-unit">ì›</span>
                        </div>
                        <div class="expense-memo-input">
                            <input type="text" id="expenseMemo" placeholder="ë©”ëª¨ (ì„ íƒì‚¬í•­)" maxlength="50">
                        </div>
                    </div>

                    <div class="expense-buttons">
                        <button class="btn-secondary" id="cancelExpenseBtn">ì·¨ì†Œ</button>
                        <button class="btn-primary" id="addExpenseBtn">ì¶”ê°€</button>
                    </div>
                </div>

                <!-- ì˜¤ëŠ˜ ì§€ì¶œ ë‚´ì—­ -->
                <div class="today-expenses">
                    <div class="expenses-header">
                        <h4>ì˜¤ëŠ˜ ì§€ì¶œ ë‚´ì—­</h4>
                        <div class="today-total" id="todayTotal">0ì›</div>
                    </div>
                    <div class="expenses-list" id="expensesList">
                        <div class="no-expenses">ì•„ì§ ì§€ì¶œ ë‚´ì—­ì´ ì—†ìŠµë‹ˆë‹¤</div>
                    </div>
                </div>

                <!-- ì¹´í…Œê³ ë¦¬ë³„ í†µê³„ -->
                <div class="expense-summary" id="expenseSummary" style="display: none;">
                    <h4>ì¹´í…Œê³ ë¦¬ë³„ ì§€ì¶œ</h4>
                    <div class="summary-chart" id="summaryChart"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- ìƒˆë¡œìš´ ì§€ì¶œ ì…ë ¥ íŒì—… -->
    <div class="expense-popup-overlay" id="expensePopupOverlay">
        <div class="expense-popup-content">
            <div class="expense-popup-header">
                <h3>ğŸ’° ì§€ì¶œ ì¶”ê°€</h3>
                <button class="expense-popup-close" id="expensePopupClose">âœ•</button>
            </div>
            
            <!-- ì¹´í…Œê³ ë¦¬ íƒ­ ì„ íƒ -->
            <div class="expense-categories-tabs">
                <button class="category-tab active" data-category="transport" data-icon="ğŸš—" data-color="#3B82F6">
                    <span class="tab-icon">ğŸš—</span>
                    <span class="tab-label">êµí†µë¹„</span>
                </button>
                <button class="category-tab" data-category="food" data-icon="ğŸ½ï¸" data-color="#F59E0B">
                    <span class="tab-icon">ğŸ½ï¸</span>
                    <span class="tab-label">ì‹ë¹„</span>
                </button>
                <button class="category-tab" data-category="snack" data-icon="ğŸ¿" data-color="#10B981">
                    <span class="tab-icon">ğŸ¿</span>
                    <span class="tab-label">ê°„ì‹</span>
                </button>
                <button class="category-tab" data-category="shopping" data-icon="ğŸ›ï¸" data-color="#8B5CF6">
                    <span class="tab-icon">ğŸ›ï¸</span>
                    <span class="tab-label">ì‡¼í•‘</span>
                </button>
                <button class="category-tab" data-category="souvenir" data-icon="ğŸ" data-color="#EF4444">
                    <span class="tab-icon">ğŸ</span>
                    <span class="tab-label">ê¸°ë…í’ˆ</span>
                </button>
                <button class="category-tab" data-category="attraction" data-icon="ğŸ¡" data-color="#F97316">
                    <span class="tab-icon">ğŸ¡</span>
                    <span class="tab-label">ê´€ê´‘</span>
                </button>
                <button class="category-tab" data-category="accommodation" data-icon="ğŸ¨" data-color="#059669">
                    <span class="tab-icon">ğŸ¨</span>
                    <span class="tab-label">ìˆ™ë°•ë¹„</span>
                </button>
                <button class="category-tab" data-category="other" data-icon="ğŸ’³" data-color="#6B7280">
                    <span class="tab-icon">ğŸ’³</span>
                    <span class="tab-label">ê¸°íƒ€</span>
                </button>
            </div>
            
            <!-- ê¸ˆì•¡ ì…ë ¥ ì„¹ì…˜ -->
            <div class="expense-amount-section">
                <div class="amount-display">
                    <span class="currency-symbol">â‚©</span>
                    <span class="amount-value" id="amountDisplay">0</span>
                </div>
                
                <!-- ë¹ ë¥¸ ê¸ˆì•¡ ë²„íŠ¼ -->
                <div class="quick-amount-buttons">
                    <button class="quick-amount-btn" data-amount="1000">+1ì²œ</button>
                    <button class="quick-amount-btn" data-amount="5000">+5ì²œ</button>
                    <button class="quick-amount-btn" data-amount="10000">+1ë§Œ</button>
                    <button class="quick-amount-btn" data-amount="50000">+5ë§Œ</button>
                </div>
                
                <!-- ê¸ˆì•¡ ì§ì ‘ ì…ë ¥ -->
                <div class="expense-amount-input-section">
                    <input type="number" id="expenseAmountInput" placeholder="ê¸ˆì•¡ì„ ì…ë ¥í•˜ì„¸ìš”" min="0" step="100">
                </div>
                
                <!-- ë©”ëª¨ ì…ë ¥ -->
                <div class="expense-memo-section">
                    <input type="text" id="expenseMemoInput" placeholder="ë©”ëª¨ (ì„ íƒì‚¬í•­)" maxlength="30">
                </div>
            </div>
            
            <!-- ì•¡ì…˜ ë²„íŠ¼ -->
            <div class="expense-actions">
                <button class="btn-secondary" id="expenseCancelBtn">ì·¨ì†Œ</button>
                <button class="btn-primary" id="expenseAddBtn" disabled>ì¶”ê°€í•˜ê¸°</button>
            </div>
        </div>
    </div>

    <!-- í•˜ë‹¨ Floating Action Button ì‹œìŠ¤í…œ -->
    <div class="fab-container">
        <!-- ë©”ì¸ FAB ë²„íŠ¼ -->
        <button class="fab-main" id="fabMain" title="ë¹ ë¥¸ ë„êµ¬">
            <span class="fab-icon">âš¡</span>
        </button>
        
        <!-- í™•ì¥ ë©”ë‰´ -->
        <div class="fab-menu" id="fabMenu">
            <!-- ì§€ì¶œ ì¶”ê°€ -->
            <button class="fab-item fab-expense" id="fabExpense" data-action="expense">
                <span class="fab-item-icon">ğŸ’°</span>
                <span class="fab-item-label">ì§€ì¶œ</span>
            </button>
            
            <!-- í™˜ìœ¨ ê³„ì‚°ê¸° -->
            <button class="fab-item fab-exchange" id="fabExchange" data-action="exchange">
                <span class="fab-item-icon">ğŸ’±</span>
                <span class="fab-item-label">í™˜ìœ¨</span>
            </button>
            
            <!-- ê°¤ëŸ­ì‹œ ë§µ -->
            <button class="fab-item fab-galaxy-map" id="fabGalaxyMap" data-action="galaxy-map">
                <span class="fab-item-icon">ğŸ—ºï¸</span>
                <span class="fab-item-label">ê°¤ëŸ­ì‹œë§µ</span>
            </button>
        </div>
        
        <!-- FAB ë°°ê²½ ì˜¤ë²„ë ˆì´ -->
        <div class="fab-overlay" id="fabOverlay"></div>
    </div>

    <!-- ê°¤ëŸ­ì‹œ ë§µ ëª¨ë‹¬ -->
    <div class="galaxy-map-modal" id="galaxyMapModal">
        <div class="galaxy-map-container">
            <div class="galaxy-map-header">
                <h3 class="galaxy-map-title">ê°¤ëŸ­ì‹œ ë§ˆì¹´ì˜¤ ë¦¬ì¡°íŠ¸ ë§µ</h3>
                <button class="galaxy-map-close" id="galaxyMapClose">âœ•</button>
            </div>
            
            <div class="galaxy-map-tabs">
                <button class="galaxy-map-tab active" data-floor="gf">G/F (ê·¸ëœë“œ í”Œë¡œì–´)</button>
                <button class="galaxy-map-tab" data-floor="1f">1/F (1ì¸µ)</button>
            </div>
            
            <div class="galaxy-map-content">
                <div class="galaxy-map-floor active" id="floor-gf">
                    <img src="https://img.galaxymacau.com/media_library/GM1114-BDC-2506-004-Property-Map_Jul-Aug_KR-03.jpg?x-oss-process=image/format%2Cwebp/quality%2Cq_75" 
                         alt="ê°¤ëŸ­ì‹œ ë§ˆì¹´ì˜¤ G/F ë§µ" 
                         class="galaxy-map-image"
                         loading="lazy">
                </div>
                <div class="galaxy-map-floor" id="floor-1f">
                    <img src="https://img.galaxymacau.com/media_library/GM1114-BDC-2506-004-Property-Map_Jul-Aug_KR-04.jpg?x-oss-process=image/format%2Cwebp/quality%2Cq_75" 
                         alt="ê°¤ëŸ­ì‹œ ë§ˆì¹´ì˜¤ 1/F ë§µ" 
                         class="galaxy-map-image"
                         loading="lazy">
                </div>
            </div>
        </div>
    </div>

    <!-- JavaScript ëª¨ë“ˆ íŒŒì¼ -->
    <script src="./macau/config/config.js"></script>
    <script src="./macau/config/places-api.js"></script>
    <script src="./macau/config/enhance-places.js"></script>
    
    <!-- ë©”ì¸ ì• í”Œë¦¬ì¼€ì´ì…˜ (ES6 ëª¨ë“ˆ) -->
    <script type="module" src="./macau/js/core/app.js"></script>
    
    <!-- ë ˆê±°ì‹œ ì§€ì›ì„ ìœ„í•œ ê¸°ì¡´ ì½”ë“œ (ì„ì‹œ) -->
    <script>
        // ì „ì—­ í•¨ìˆ˜ë“¤ì„ ì„ì‹œë¡œ ìœ ì§€ (ëª¨ë“ˆí™” ì™„ë£Œ í›„ ì œê±° ì˜ˆì •)
        // ìŠ¬ë¼ì´ë” ìƒíƒœ ê´€ë¦¬
        const sliderState = {};

        function initSlider(sliderId) {
            if (!sliderState[sliderId]) {
                const slider = document.getElementById(sliderId);
                if (slider) {
                    const images = slider.querySelectorAll('.place-images-slider img');
                    sliderState[sliderId] = {
                        currentIndex: 0,
                        totalSlides: images.length
                    };
                }
            }
        }

        function showSlide(sliderId, slideIndex) {
            initSlider(sliderId);
            const slider = document.getElementById(sliderId);
            if (!slider) return;

            const sliderContainer = slider.querySelector('.place-images-slider');
            const dots = slider.querySelectorAll('.place-images-dot');
            const counter = slider.querySelector('.place-images-counter');
            
            if (!sliderContainer || !sliderState[sliderId]) return;

            const totalSlides = sliderState[sliderId].totalSlides;
            
            // ì¸ë±ìŠ¤ ë²”ìœ„ ì²´í¬
            if (slideIndex < 0) slideIndex = totalSlides - 1;
            if (slideIndex >= totalSlides) slideIndex = 0;
            
            sliderState[sliderId].currentIndex = slideIndex;
            
            // ìŠ¬ë¼ì´ë” ì´ë™
            sliderContainer.style.transform = `translateX(-${slideIndex * 100}%)`;
            
            // ë„íŠ¸ í™œì„±í™” ìƒíƒœ ì—…ë°ì´íŠ¸
            dots.forEach((dot, index) => {
                dot.classList.toggle('active', index === slideIndex);
            });
            
            // ì¹´ìš´í„° ì—…ë°ì´íŠ¸
            if (counter) {
                counter.textContent = `${slideIndex + 1}/${totalSlides}`;
            }
        }

        function nextSlide(sliderId) {
            initSlider(sliderId);
            if (sliderState[sliderId]) {
                const nextIndex = sliderState[sliderId].currentIndex + 1;
                showSlide(sliderId, nextIndex);
            }
        }

        function prevSlide(sliderId) {
            initSlider(sliderId);
            if (sliderState[sliderId]) {
                const prevIndex = sliderState[sliderId].currentIndex - 1;
                showSlide(sliderId, prevIndex);
            }
        }

        // ì´ë¯¸ì§€ í™•ëŒ€ ê¸°ëŠ¥
        function openImageModal(imageSrc, altText) {
            // ëª¨ë‹¬ ìƒì„±
            const modal = document.createElement('div');
            modal.className = 'image-modal';
            modal.innerHTML = `
                <div class="image-modal-overlay" onclick="closeImageModal()">
                    <div class="image-modal-content">
                        <img src="${imageSrc}" alt="${altText}" onclick="event.stopPropagation()">
                        <button class="image-modal-close" onclick="closeImageModal()">Ã—</button>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
            
            // ì• ë‹ˆë©”ì´ì…˜ì„ ìœ„í•œ ì§€ì—°
            setTimeout(() => modal.classList.add('active'), 10);
        }

        function closeImageModal() {
            const modal = document.querySelector('.image-modal');
            if (modal) {
                modal.classList.remove('active');
                setTimeout(() => modal.remove(), 300);
            }
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ëª¨ë“  ìŠ¬ë¼ì´ë” ì´ˆê¸°í™”
        document.addEventListener('DOMContentLoaded', () => {
            // ëª¨ë“  ìŠ¬ë¼ì´ë” ì°¾ê¸°
            const sliders = document.querySelectorAll('.place-images');
            sliders.forEach(slider => {
                const sliderId = slider.id;
                if (sliderId) {
                    initSlider(sliderId);
                    showSlide(sliderId, 0); // ì²« ë²ˆì§¸ ìŠ¬ë¼ì´ë“œ í‘œì‹œ
                    
                    // ì´ë¯¸ì§€ í´ë¦­ ì´ë²¤íŠ¸ ì¶”ê°€ (í™•ëŒ€)
                    const images = slider.querySelectorAll('.place-images-slider img');
                    images.forEach(img => {
                        img.style.cursor = 'pointer';
                        img.addEventListener('click', () => {
                            openImageModal(img.src, img.alt);
                        });
                    });
                }
            });
        });
        function openFlightTicket() {
            console.log('Legacy openFlightTicket called');
        }
    </script>
    
    <!-- Service Worker ë“±ë¡ -->
    <script>
        // Service Worker ë“±ë¡ (PWA 404 ì—ëŸ¬ í•´ê²°)
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/sw.js')
                    .then((registration) => {
                        console.log('SW registered: ', registration);
                        
                        // ì—…ë°ì´íŠ¸ í™•ì¸
                        registration.addEventListener('updatefound', () => {
                            const newWorker = registration.installing;
                            newWorker.addEventListener('statechange', () => {
                                if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {
                                    // ìƒˆ ë²„ì „ì´ ì„¤ì¹˜ë¨, ì‚¬ìš©ìì—ê²Œ ìƒˆë¡œê³ ì¹¨ ì•ˆë‚´
                                    if (confirm('ìƒˆ ë²„ì „ì´ ì‚¬ìš© ê°€ëŠ¥í•©ë‹ˆë‹¤. í˜ì´ì§€ë¥¼ ìƒˆë¡œê³ ì¹¨í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                                        window.location.reload();
                                    }
                                }
                            });
                        });
                    })
                    .catch((registrationError) => {
                        console.log('SW registration failed: ', registrationError);
                    });
            });
        }
        
        // PWA ì„¤ì¹˜ ë²„íŠ¼ ì²˜ë¦¬
        let deferredPrompt;
        
        window.addEventListener('beforeinstallprompt', (e) => {
            // ê¸°ë³¸ ì„¤ì¹˜ í”„ë¡¬í”„íŠ¸ ë°©ì§€
            e.preventDefault();
            deferredPrompt = e;
            
            // ì‚¬ìš©ì ì •ì˜ ì„¤ì¹˜ ì•ˆë‚´ í‘œì‹œ
            const installGuide = document.getElementById('installGuideOverlay');
            if (installGuide && !localStorage.getItem('installGuideShown')) {
                installGuide.style.display = 'flex';
                localStorage.setItem('installGuideShown', 'true');
            }
        });
        
        // ì•± ì„¤ì¹˜ë¨ ê°ì§€
        window.addEventListener('appinstalled', (evt) => {
            console.log('PWA was installed');
            deferredPrompt = null;
        });
        
        // ê°¤ëŸ­ì‹œ ë§µ ê¸°ëŠ¥
        function initGalaxyMap() {
            const galaxyMapBtn = document.getElementById('fabGalaxyMap');
            const galaxyMapModal = document.getElementById('galaxyMapModal');
            const galaxyMapClose = document.getElementById('galaxyMapClose');
            const galaxyMapTabs = document.querySelectorAll('.galaxy-map-tab');
            const galaxyMapFloors = document.querySelectorAll('.galaxy-map-floor');
            
            // ê°¤ëŸ­ì‹œ ë§µ ëª¨ë‹¬ ì—´ê¸° í•¨ìˆ˜
            function openGalaxyMap() {
                galaxyMapModal.classList.add('show');
                document.body.style.overflow = 'hidden';
                
                // ëª¨ë“ˆí™”ëœ ë’¤ë¡œê°€ê¸° ì‹œìŠ¤í…œì— ë“±ë¡
                if (typeof window.registerPopup === 'function') {
                    window.registerPopup('galaxy-map', closeGalaxyMap);
                }
                
                // FAB ë©”ë‰´ ë‹«ê¸°
                const fabMenu = document.getElementById('fabMenu');
                const fabMain = document.getElementById('fabMain');
                const fabOverlay = document.getElementById('fabOverlay');
                if (fabMenu && fabMain && fabOverlay) {
                    fabMenu.classList.remove('show');
                    fabMain.classList.remove('active');
                    fabOverlay.classList.remove('show');
                }
            }
            
            // ê°¤ëŸ­ì‹œ ë§µ ëª¨ë‹¬ ë‹«ê¸° í•¨ìˆ˜
            function closeGalaxyMap() {
                galaxyMapModal.classList.remove('show');
                document.body.style.overflow = '';
                
                // ëª¨ë“ˆí™”ëœ ë’¤ë¡œê°€ê¸° ì‹œìŠ¤í…œì—ì„œ ì œê±°
                if (typeof window.unregisterPopup === 'function') {
                    window.unregisterPopup('galaxy-map');
                }
            }
            
            // ê°¤ëŸ­ì‹œ ë§µ ë²„íŠ¼ í´ë¦­
            if (galaxyMapBtn) {
                galaxyMapBtn.addEventListener('click', openGalaxyMap);
            }
            
            // ëª¨ë‹¬ ë‹«ê¸° ë²„íŠ¼
            if (galaxyMapClose) {
                galaxyMapClose.addEventListener('click', closeGalaxyMap);
            }
            
            // ëª¨ë‹¬ ë°°ê²½ í´ë¦­ ì‹œ ë‹«ê¸°
            galaxyMapModal.addEventListener('click', (e) => {
                if (e.target === galaxyMapModal) {
                    closeGalaxyMap();
                }
            });
            
            // ì¸µë³„ íƒ­ ì „í™˜
            galaxyMapTabs.forEach(tab => {
                tab.addEventListener('click', () => {
                    const targetFloor = tab.dataset.floor;
                    
                    // ëª¨ë“  íƒ­ ë¹„í™œì„±í™”
                    galaxyMapTabs.forEach(t => t.classList.remove('active'));
                    // í˜„ì¬ íƒ­ í™œì„±í™”
                    tab.classList.add('active');
                    
                    // ëª¨ë“  ì¸µ ìˆ¨ê¸°ê¸°
                    galaxyMapFloors.forEach(floor => floor.classList.remove('active'));
                    // ì„ íƒëœ ì¸µ í‘œì‹œ
                    const targetFloorElement = document.getElementById(`floor-${targetFloor}`);
                    if (targetFloorElement) {
                        targetFloorElement.classList.add('active');
                    }
                });
            });
            
            // ESC í‚¤ë¡œ ëª¨ë‹¬ ë‹«ê¸°
            document.addEventListener('keydown', (e) => {
                if (e.key === 'Escape' && galaxyMapModal.classList.contains('show')) {
                    closeGalaxyMap();
                }
            });
        }
        
        // PWA ì•± ì¢…ë£Œ í™•ì¸ (ì¦‰ì‹œ ì ìš©)
        function initPWAExitConfirmation() {
            console.log('ì¦‰ì‹œ PWA ì¢…ë£Œ í™•ì¸ í•¸ë“¤ëŸ¬ ë“±ë¡');
            
            // ì¦‰ì‹œ íˆìŠ¤í† ë¦¬ ìƒíƒœ ì„¤ì •
            if (!history.state || !history.state.appInit) {
                history.replaceState({ page: 'main', appInit: true }, '', window.location.href);
                history.pushState({ page: 'main', canExit: true }, '', window.location.href);
            }
            
            // ì¦‰ì‹œ popstate ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬ ë“±ë¡
            window.addEventListener('popstate', (event) => {
                console.log('ğŸ”™ ì¦‰ì‹œ í•¸ë“¤ëŸ¬ - ë’¤ë¡œê°€ê¸° ê°ì§€:', event.state);
                
                // ëª¨ë“ˆí™”ëœ ì‹œìŠ¤í…œì´ ì¤€ë¹„ë˜ì—ˆëŠ”ì§€ í™•ì¸
                if (typeof window.hasOpenPopups === 'function' && window.hasOpenPopups()) {
                    console.log('ğŸ”™ íŒì—…ì´ ì—´ë ¤ìˆìŒ - ëª¨ë“ˆí™”ëœ ì‹œìŠ¤í…œì—ì„œ ì²˜ë¦¬');
                    return;
                }
                
                // íŒì—…ì´ ì—†ìœ¼ë©´ ì•± ì¢…ë£Œ í™•ì¸
                console.log('ğŸ”™ ì¦‰ì‹œ í•¸ë“¤ëŸ¬ - ì•± ì¢…ë£Œ í™•ì¸');
                const confirmExit = confirm('ë§ˆì¹´ì˜¤ ì—¬í–‰ ì•±ì„ ì¢…ë£Œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?');
                
                if (confirmExit) {
                    if (window.navigator.standalone) {
                        window.location.href = 'about:blank';
                    } else {
                        window.close();
                    }
                } else {
                    // ì·¨ì†Œ ì‹œ íˆìŠ¤í† ë¦¬ ë³µì›
                    history.pushState({ page: 'main', canExit: true }, '', window.location.href);
                }
            });
        }
        
        // ì¦‰ì‹œ PWA ì¢…ë£Œ í™•ì¸ ì´ˆê¸°í™” (ëª¨ë“ˆ ë¡œë”© ì „ì—)
        initPWAExitConfirmation();
        
        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸°í™”
        document.addEventListener('DOMContentLoaded', () => {
            initGalaxyMap();
        });
    </script>
</body>
</html>