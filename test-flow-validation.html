<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì „ì²´ í”Œë¡œìš° í…ŒìŠ¤íŠ¸ ë° ê²€ì¦</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 p-8">
    <div class="max-w-4xl mx-auto">
        <h1 class="text-3xl font-bold mb-8 text-center">TripCrafter PWA ì‹œìŠ¤í…œ í…ŒìŠ¤íŠ¸</h1>
        
        <!-- í…ŒìŠ¤íŠ¸ ê²°ê³¼ í‘œì‹œ ì˜ì—­ -->
        <div id="test-results" class="space-y-4"></div>
        
        <!-- í…ŒìŠ¤íŠ¸ ì‹¤í–‰ ë²„íŠ¼ -->
        <div class="text-center mt-8">
            <button id="run-tests" class="bg-blue-600 text-white px-6 py-3 rounded-lg hover:bg-blue-700 transition">
                ì „ì²´ í…ŒìŠ¤íŠ¸ ì‹¤í–‰
            </button>
        </div>
    </div>

    <script>
        class PWASystemTester {
            constructor() {
                this.testResults = [];
                this.testContainer = document.getElementById('test-results');
            }

            async runAllTests() {
                this.testResults = [];
                this.updateUI('í…ŒìŠ¤íŠ¸ ì‹œì‘...', 'info');
                
                // í…ŒìŠ¤íŠ¸ ëª©ë¡
                const tests = [
                    { name: 'mock_first_step_resp.json íŒŒì¼ ì¡´ì¬ í™•ì¸', test: this.testMockDataExists },
                    { name: 'main-script.js ë¡œë”© í…ŒìŠ¤íŠ¸', test: this.testMainScriptLoading },
                    { name: 'TravelPWARenderer í´ë˜ìŠ¤ ì¡´ì¬ í™•ì¸', test: this.testRendererClass },
                    { name: 'mock_first_step_resp.json ìŠ¤í‚¤ë§ˆ ê²€ì¦', test: this.testMockDataSchema },
                    { name: 'ë°ì´í„° ì •ê·œí™” ê¸°ëŠ¥ í…ŒìŠ¤íŠ¸', test: this.testDataNormalization },
                    { name: 'í•­ê³µí¸ ì •ë³´ ì¶”ì¶œ í…ŒìŠ¤íŠ¸', test: this.testFlightInfoExtraction },
                    { name: 'êµí†µí¸ ì •ë³´ ë§¤í•‘ í…ŒìŠ¤íŠ¸', test: this.testTransportationMapping },
                    { name: 'ì˜ˆì‚° ì •ë³´ ì²˜ë¦¬ í…ŒìŠ¤íŠ¸', test: this.testBudgetProcessing },
                    { name: 'ì¼ì¼ íŒ ì¶”ì¶œ í…ŒìŠ¤íŠ¸', test: this.testDailyTipsExtraction },
                    { name: 'í…œí”Œë¦¿ í—¬í¼ í•¨ìˆ˜ë“¤ í…ŒìŠ¤íŠ¸', test: this.testHelperFunctions }
                ];

                // ê° í…ŒìŠ¤íŠ¸ ì‹¤í–‰
                for (const test of tests) {
                    try {
                        await test.test.call(this);
                        this.logResult(test.name, true, 'í†µê³¼');
                    } catch (error) {
                        this.logResult(test.name, false, error.message);
                    }
                }

                this.displaySummary();
            }

            async testMockDataExists() {
                const response = await fetch('./mock_first_step_resp.json');
                if (!response.ok) {
                    throw new Error('mock_first_step_resp.json íŒŒì¼ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                }
            }

            async testMainScriptLoading() {
                if (typeof TravelPWARenderer === 'undefined') {
                    // ë™ì ìœ¼ë¡œ main-script.js ë¡œë“œ ì‹œë„
                    await this.loadScript('./main-script.js');
                }
                
                if (typeof TravelPWARenderer === 'undefined') {
                    throw new Error('main-script.js ë¡œë”© ì‹¤íŒ¨ ë˜ëŠ” TravelPWARenderer í´ë˜ìŠ¤ ì—†ìŒ');
                }
            }

            async testRendererClass() {
                const renderer = new TravelPWARenderer();
                if (!renderer.normalizeData || typeof renderer.normalizeData !== 'function') {
                    throw new Error('TravelPWARendererì—ì„œ normalizeData ë©”ì„œë“œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                }
            }

            async testMockDataSchema() {
                const response = await fetch('./mock_first_step_resp.json');
                const mockData = await response.json();
                
                // í•„ìˆ˜ í•„ë“œ ê²€ì¦
                const requiredFields = ['responseType', 'tripPlan'];
                const tripPlanFields = ['tripInfo', 'itinerary', 'dailyTips'];
                const tripInfoFields = ['destination', 'tripTitle', 'startDate', 'endDate'];
                
                requiredFields.forEach(field => {
                    if (!mockData[field]) {
                        throw new Error(`í•„ìˆ˜ í•„ë“œ ëˆ„ë½: ${field}`);
                    }
                });
                
                tripPlanFields.forEach(field => {
                    if (!mockData.tripPlan[field]) {
                        throw new Error(`tripPlan í•„ìˆ˜ í•„ë“œ ëˆ„ë½: ${field}`);
                    }
                });
                
                tripInfoFields.forEach(field => {
                    if (!mockData.tripPlan.tripInfo[field]) {
                        throw new Error(`tripInfo í•„ìˆ˜ í•„ë“œ ëˆ„ë½: ${field}`);
                    }
                });
            }

            async testDataNormalization() {
                const response = await fetch('./mock_first_step_resp.json');
                const mockData = await response.json();
                
                const renderer = new TravelPWARenderer();
                const normalizedData = renderer.normalizeData(mockData);
                
                // ì •ê·œí™”ëœ ë°ì´í„° í•„ìˆ˜ í•„ë“œ ê²€ì¦
                const requiredNormalizedFields = ['title', 'destination', 'duration', 'days', 'flightInfo', 'dailyTips'];
                requiredNormalizedFields.forEach(field => {
                    if (!normalizedData[field]) {
                        throw new Error(`ì •ê·œí™”ëœ ë°ì´í„°ì—ì„œ í•„ìˆ˜ í•„ë“œ ëˆ„ë½: ${field}`);
                    }
                });
                
                if (normalizedData.days.length === 0) {
                    throw new Error('ì¼ì • ë°ì´í„°ê°€ ì •ê·œí™”ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.');
                }
            }

            async testFlightInfoExtraction() {
                const response = await fetch('./mock_first_step_resp.json');
                const mockData = await response.json();
                
                const renderer = new TravelPWARenderer();
                const normalizedData = renderer.normalizeData(mockData);
                
                if (!normalizedData.flightInfo || !normalizedData.flightInfo.outbound) {
                    throw new Error('í•­ê³µí¸ ì •ë³´ê°€ ì œëŒ€ë¡œ ì¶”ì¶œë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.');
                }
                
                if (!normalizedData.flightInfo.outbound.airline || !normalizedData.flightInfo.outbound.time) {
                    throw new Error('ì¶œêµ­í¸ ì •ë³´ê°€ ì™„ì „í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.');
                }
            }

            async testTransportationMapping() {
                const response = await fetch('./mock_first_step_resp.json');
                const mockData = await response.json();
                
                const renderer = new TravelPWARenderer();
                const normalizedData = renderer.normalizeData(mockData);
                
                // êµí†µí¸ ê´€ë ¨ í™œë™ì´ ìˆëŠ”ì§€ í™•ì¸
                const hasTransportActivity = normalizedData.days.some(day => 
                    day.activities.some(activity => activity.type === 'transport')
                );
                
                if (!hasTransportActivity) {
                    throw new Error('êµí†µí¸ í™œë™ì´ ì •ê·œí™”ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.');
                }
                
                // transportation ì •ë³´ê°€ ì¶”ì¶œë˜ì—ˆëŠ”ì§€ í™•ì¸
                if (!normalizedData.transportation || normalizedData.transportation.length === 0) {
                    throw new Error('êµí†µí¸ íŒ ì •ë³´ê°€ ì¶”ì¶œë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.');
                }
            }

            async testBudgetProcessing() {
                const response = await fetch('./mock_first_step_resp.json');
                const mockData = await response.json();
                
                const renderer = new TravelPWARenderer();
                const normalizedData = renderer.normalizeData(mockData);
                
                if (!normalizedData.estimatedBudget || !normalizedData.estimatedBudget.total) {
                    throw new Error('ì˜ˆì‚° ì •ë³´ê°€ ì œëŒ€ë¡œ ì²˜ë¦¬ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.');
                }
                
                if (normalizedData.estimatedBudget.total <= 0) {
                    throw new Error('ì˜ˆì‚° ê¸ˆì•¡ì´ ìœ íš¨í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.');
                }
            }

            async testDailyTipsExtraction() {
                const response = await fetch('./mock_first_step_resp.json');
                const mockData = await response.json();
                
                const renderer = new TravelPWARenderer();
                const normalizedData = renderer.normalizeData(mockData);
                
                if (!normalizedData.dailyTips || normalizedData.dailyTips.length === 0) {
                    throw new Error('ì¼ì¼ íŒì´ ì¶”ì¶œë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.');
                }
                
                // íŠ¹ì • íƒ€ì…ì˜ íŒì´ ìˆëŠ”ì§€ í™•ì¸ (transportation, eggTart, kids ë“±)
                const tipTypes = normalizedData.dailyTips.map(tip => tip.type);
                const expectedTypes = ['transportation', 'eggTart', 'kids'];
                
                const hasExpectedTips = expectedTypes.some(type => tipTypes.includes(type));
                if (!hasExpectedTips) {
                    throw new Error('ì˜ˆìƒëœ íƒ€ì…ì˜ íŒì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                }
            }

            async testHelperFunctions() {
                const renderer = new TravelPWARenderer();
                
                // calculateDuration í…ŒìŠ¤íŠ¸
                const duration = renderer.calculateDuration('09:00', '12:00');
                if (duration !== 180) {
                    throw new Error('ì‹œê°„ ê³„ì‚° í•¨ìˆ˜ê°€ ì œëŒ€ë¡œ ë™ì‘í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.');
                }
                
                // calculateDays í…ŒìŠ¤íŠ¸
                const days = renderer.calculateDays('2025-07-27', '2025-07-30');
                if (!days.includes('3ë°•4ì¼')) {
                    throw new Error('ì¼ìˆ˜ ê³„ì‚° í•¨ìˆ˜ê°€ ì œëŒ€ë¡œ ë™ì‘í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.');
                }
                
                // generateTripDates í…ŒìŠ¤íŠ¸
                renderer.travelData = {
                    startDate: '2025-07-27',
                    endDate: '2025-07-30'
                };
                const tripDates = renderer.generateTripDates();
                if (!tripDates.includes('7ì›”')) {
                    throw new Error('ì—¬í–‰ ë‚ ì§œ ìƒì„± í•¨ìˆ˜ê°€ ì œëŒ€ë¡œ ë™ì‘í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.');
                }
            }

            logResult(testName, success, message) {
                this.testResults.push({ testName, success, message });
            }

            updateUI(message, type = 'info') {
                const div = document.createElement('div');
                const colorClass = type === 'info' ? 'bg-blue-100 text-blue-800' : 
                                 type === 'success' ? 'bg-green-100 text-green-800' : 
                                 'bg-red-100 text-red-800';
                
                div.className = `p-4 rounded-lg ${colorClass}`;
                div.textContent = message;
                this.testContainer.appendChild(div);
            }

            displaySummary() {
                const passed = this.testResults.filter(r => r.success).length;
                const total = this.testResults.length;
                const failed = total - passed;

                // í…ŒìŠ¤íŠ¸ ê²°ê³¼ ìƒì„¸ í‘œì‹œ
                this.testResults.forEach(result => {
                    const div = document.createElement('div');
                    const statusIcon = result.success ? 'âœ…' : 'âŒ';
                    const colorClass = result.success ? 'bg-green-50 border-green-200' : 'bg-red-50 border-red-200';
                    
                    div.className = `p-4 border rounded-lg ${colorClass}`;
                    div.innerHTML = `
                        <div class="flex justify-between items-start">
                            <div>
                                <h3 class="font-medium">${statusIcon} ${result.testName}</h3>
                                <p class="text-sm text-gray-600 mt-1">${result.message}</p>
                            </div>
                        </div>
                    `;
                    this.testContainer.appendChild(div);
                });

                // ì´í•© ê²°ê³¼
                const summaryDiv = document.createElement('div');
                const overallSuccess = failed === 0;
                const summaryColor = overallSuccess ? 'bg-green-100 border-green-300 text-green-800' : 'bg-red-100 border-red-300 text-red-800';
                
                summaryDiv.className = `p-6 border-2 rounded-lg ${summaryColor} mt-6`;
                summaryDiv.innerHTML = `
                    <h2 class="text-xl font-bold mb-2">í…ŒìŠ¤íŠ¸ ê²°ê³¼ ìš”ì•½</h2>
                    <p class="text-lg">
                        ì´ ${total}ê°œ í…ŒìŠ¤íŠ¸ ì¤‘ ${passed}ê°œ í†µê³¼, ${failed}ê°œ ì‹¤íŒ¨
                    </p>
                    <p class="mt-2 font-medium">
                        ${overallSuccess ? 'ğŸ‰ ëª¨ë“  í…ŒìŠ¤íŠ¸ í†µê³¼!' : 'âš ï¸ ì¼ë¶€ í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨ - ìˆ˜ì • í•„ìš”'}
                    </p>
                `;
                this.testContainer.appendChild(summaryDiv);
            }

            loadScript(src) {
                return new Promise((resolve, reject) => {
                    const script = document.createElement('script');
                    script.src = src;
                    script.onload = resolve;
                    script.onerror = reject;
                    document.head.appendChild(script);
                });
            }
        }

        // í…ŒìŠ¤íŠ¸ ì‹¤í–‰
        document.getElementById('run-tests').addEventListener('click', async () => {
            const tester = new PWASystemTester();
            await tester.runAllTests();
        });

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ìë™ ì‹¤í–‰
        window.addEventListener('load', async () => {
            const tester = new PWASystemTester();
            await tester.runAllTests();
        });
    </script>
</body>
</html>