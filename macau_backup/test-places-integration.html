<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Places API í†µí•© í…ŒìŠ¤íŠ¸</title>
    <link rel="stylesheet" href="./macau.css">
    <style>
        .test-container {
            max-width: 800px;
            margin: 20px auto;
            padding: 20px;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', system-ui, sans-serif;
        }
        
        .test-section {
            background: #f8fafc;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
        }
        
        .test-title {
            font-size: 18px;
            font-weight: 600;
            color: #1e293b;
            margin-bottom: 16px;
        }
        
        .test-button {
            background: #3b82f6;
            color: white;
            border: none;
            padding: 10px 16px;
            border-radius: 6px;
            cursor: pointer;
            margin-right: 8px;
            margin-bottom: 8px;
        }
        
        .test-button:hover {
            background: #2563eb;
        }
        
        .test-result {
            background: #ffffff;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            padding: 12px;
            margin-top: 12px;
            font-family: monospace;
            font-size: 12px;
            white-space: pre-wrap;
            max-height: 300px;
            overflow-y: auto;
        }
        
        .success {
            background: #dcfce7;
            border-color: #86efac;
            color: #15803d;
        }
        
        .error {
            background: #fef2f2;
            border-color: #fca5a5;
            color: #dc2626;
        }
        
        .image-test-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 16px;
            margin-top: 16px;
        }
        
        .image-test-item {
            background: white;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            padding: 12px;
            text-align: center;
        }
        
        .image-test-item img {
            width: 100%;
            height: 120px;
            object-fit: cover;
            border-radius: 6px;
            margin-bottom: 8px;
        }
        
        .status-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
        }
        
        .status-loading {
            background: #fbbf24;
        }
        
        .status-success {
            background: #10b981;
        }
        
        .status-error {
            background: #ef4444;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>ğŸ§ª Google Places API í†µí•© í…ŒìŠ¤íŠ¸</h1>
        <p>Day1.htmlì˜ Google Places API í†µí•©ì„ í…ŒìŠ¤íŠ¸í•©ë‹ˆë‹¤.</p>
        
        <!-- API ì—°ê²° í…ŒìŠ¤íŠ¸ -->
        <div class="test-section">
            <div class="test-title">1. API ì—°ê²° í…ŒìŠ¤íŠ¸</div>
            <button class="test-button" onclick="testAPIConnection()">API ì—°ê²° í™•ì¸</button>
            <button class="test-button" onclick="testPlacesService()">Places Service í™•ì¸</button>
            <div id="api-test-result" class="test-result"></div>
        </div>
        
        <!-- ì¥ì†Œ ê²€ìƒ‰ í…ŒìŠ¤íŠ¸ -->
        <div class="test-section">
            <div class="test-title">2. ì¥ì†Œ ê²€ìƒ‰ í…ŒìŠ¤íŠ¸</div>
            <button class="test-button" onclick="testPlaceSearch('ë§ˆì¹´ì˜¤êµ­ì œê³µí•­')">ë§ˆì¹´ì˜¤êµ­ì œê³µí•­ ê²€ìƒ‰</button>
            <button class="test-button" onclick="testPlaceSearch('ì•ˆë‹¤ì¦ˆ ë§ˆì¹´ì˜¤')">ì•ˆë‹¤ì¦ˆ ë§ˆì¹´ì˜¤ ê²€ìƒ‰</button>
            <button class="test-button" onclick="testPlaceSearch('ê°¤ëŸ­ì‹œ ë§ˆì¹´ì˜¤')">ê°¤ëŸ­ì‹œ ë§ˆì¹´ì˜¤ ê²€ìƒ‰</button>
            <div id="place-search-result" class="test-result"></div>
        </div>
        
        <!-- ì´ë¯¸ì§€ ë¡œë”© í…ŒìŠ¤íŠ¸ -->
        <div class="test-section">
            <div class="test-title">3. ì´ë¯¸ì§€ ë¡œë”© í…ŒìŠ¤íŠ¸</div>
            <button class="test-button" onclick="testImageLoading()">ëª¨ë“  ì¥ì†Œ ì´ë¯¸ì§€ í…ŒìŠ¤íŠ¸</button>
            <button class="test-button" onclick="clearImageTest()">ê²°ê³¼ ì´ˆê¸°í™”</button>
            
            <div class="image-test-grid" id="image-test-grid">
                <!-- ë™ì ìœ¼ë¡œ ìƒì„±ë¨ -->
            </div>
        </div>
        
        <!-- ì‹¤ì‹œê°„ ì´ë¯¸ì§€ ê°±ì‹  í…ŒìŠ¤íŠ¸ -->
        <div class="test-section">
            <div class="test-title">4. ì‹¤ì‹œê°„ ì´ë¯¸ì§€ ê°±ì‹  í…ŒìŠ¤íŠ¸</div>
            <p>ì‹¤ì œ Day1.htmlì˜ ì´ë¯¸ì§€ ìŠ¬ë¼ì´ë”ë¥¼ í…ŒìŠ¤íŠ¸í•©ë‹ˆë‹¤.</p>
            
            <!-- ë§ˆì¹´ì˜¤ êµ­ì œê³µí•­ í…ŒìŠ¤íŠ¸ -->
            <div style="margin-bottom: 20px;">
                <h4>ë§ˆì¹´ì˜¤ êµ­ì œê³µí•­</h4>
                <div class="place-images" id="test-slider-airport">
                    <div class="place-images-slider">
                        <div class="image-loading-state">
                            <div class="loading-spinner"></div>
                            <div class="loading-text">ìµœì‹  ì´ë¯¸ì§€ ë¡œë”© ì¤‘...</div>
                        </div>
                    </div>
                    <div class="place-images-nav">
                        <div class="place-images-dot active"></div>
                        <div class="place-images-dot"></div>
                        <div class="place-images-dot"></div>
                    </div>
                    <button class="place-images-arrows place-images-prev" onclick="prevSlide('test-slider-airport')">â€¹</button>
                    <button class="place-images-arrows place-images-next" onclick="nextSlide('test-slider-airport')">â€º</button>
                    <div class="place-images-counter">ë¡œë”© ì¤‘...</div>
                </div>
            </div>
            
            <!-- ì•ˆë‹¤ì¦ˆ ë§ˆì¹´ì˜¤ í…ŒìŠ¤íŠ¸ -->
            <div style="margin-bottom: 20px;">
                <h4>ì•ˆë‹¤ì¦ˆ ë§ˆì¹´ì˜¤</h4>
                <div class="place-images" id="test-slider-andaz">
                    <div class="place-images-slider">
                        <div class="image-loading-state">
                            <div class="loading-spinner"></div>
                            <div class="loading-text">ìµœì‹  ì´ë¯¸ì§€ ë¡œë”© ì¤‘...</div>
                        </div>
                    </div>
                    <div class="place-images-nav">
                        <div class="place-images-dot active"></div>
                        <div class="place-images-dot"></div>
                        <div class="place-images-dot"></div>
                    </div>
                    <button class="place-images-arrows place-images-prev" onclick="prevSlide('test-slider-andaz')">â€¹</button>
                    <button class="place-images-arrows place-images-next" onclick="nextSlide('test-slider-andaz')">â€º</button>
                    <div class="place-images-counter">ë¡œë”© ì¤‘...</div>
                </div>
            </div>
            
            <button class="test-button" onclick="testRealImageSliders()">ì‹¤ì‹œê°„ ì´ë¯¸ì§€ ê°±ì‹  ì‹œì‘</button>
        </div>
        
        <!-- ì „ì²´ ì‹œìŠ¤í…œ í…ŒìŠ¤íŠ¸ -->
        <div class="test-section">
            <div class="test-title">5. ì „ì²´ ì‹œìŠ¤í…œ í…ŒìŠ¤íŠ¸</div>
            <button class="test-button" onclick="runFullSystemTest()">ì „ì²´ í…ŒìŠ¤íŠ¸ ì‹¤í–‰</button>
            <div id="system-test-result" class="test-result"></div>
        </div>
    </div>

    <!-- í•„ìš”í•œ ìŠ¤í¬ë¦½íŠ¸ ë¡œë“œ -->
    <script src="../config.js"></script>
    <script src="./config/places-api.js"></script>
    
    <!-- ê¸°ë³¸ ìŠ¬ë¼ì´ë” í•¨ìˆ˜ë“¤ (macau.htmlì—ì„œ ì‚¬ìš©í•˜ëŠ” ê²ƒë“¤) -->
    <script src="./js/features/image-popup.js"></script>
    
    <script>
        // í…ŒìŠ¤íŠ¸ í•¨ìˆ˜ë“¤
        let testResults = {};

        function logResult(testName, result, isSuccess = true) {
            const resultDiv = document.getElementById(testName + '-result');
            if (resultDiv) {
                resultDiv.textContent = JSON.stringify(result, null, 2);
                resultDiv.className = `test-result ${isSuccess ? 'success' : 'error'}`;
            }
            
            testResults[testName] = { result, isSuccess, timestamp: new Date().toISOString() };
            console.log(`ğŸ§ª ${testName}:`, result);
        }

        // 1. API ì—°ê²° í…ŒìŠ¤íŠ¸
        async function testAPIConnection() {
            try {
                console.log('ğŸ” API ì—°ê²° í…ŒìŠ¤íŠ¸ ì‹œì‘...');
                
                const tests = {
                    configLoaded: typeof CONFIG !== 'undefined',
                    apiKeyExists: CONFIG?.GOOGLE_PLACES_API_KEY ? true : false,
                    placesServiceExists: typeof placesService !== 'undefined',
                    imageLoaderExists: typeof imageLoader !== 'undefined'
                };
                
                logResult('api-test', tests, Object.values(tests).every(Boolean));
            } catch (error) {
                logResult('api-test', { error: error.message }, false);
            }
        }

        // Places Service í…ŒìŠ¤íŠ¸
        async function testPlacesService() {
            try {
                console.log('ğŸ¢ Places Service í…ŒìŠ¤íŠ¸ ì‹œì‘...');
                
                if (typeof placesService === 'undefined') {
                    throw new Error('Places Serviceê°€ ì´ˆê¸°í™”ë˜ì§€ ì•ŠìŒ');
                }
                
                const testResult = {
                    serviceInitialized: true,
                    methods: {
                        findPlaceByName: typeof placesService.findPlaceByName === 'function',
                        getPlaceDetails: typeof placesService.getPlaceDetails === 'function',
                        formatPlaceData: typeof placesService.formatPlaceData === 'function'
                    },
                    cache: placesService.cache instanceof Map
                };
                
                logResult('api-test', testResult, true);
            } catch (error) {
                logResult('api-test', { error: error.message }, false);
            }
        }

        // 2. ì¥ì†Œ ê²€ìƒ‰ í…ŒìŠ¤íŠ¸
        async function testPlaceSearch(placeName) {
            try {
                console.log(`ğŸ“ ${placeName} ê²€ìƒ‰ í…ŒìŠ¤íŠ¸ ì‹œì‘...`);
                
                const startTime = Date.now();
                const result = await placesService.findPlaceByName(placeName);
                const endTime = Date.now();
                
                const testResult = {
                    placeName,
                    searchTime: `${endTime - startTime}ms`,
                    found: !result.fallback,
                    hasPhotos: result.photos && result.photos.length > 0,
                    photoCount: result.photos ? result.photos.length : 0,
                    hasRating: result.rating > 0,
                    data: result
                };
                
                logResult('place-search', testResult, !result.fallback);
            } catch (error) {
                logResult('place-search', { placeName, error: error.message }, false);
            }
        }

        // 3. ì´ë¯¸ì§€ ë¡œë”© í…ŒìŠ¤íŠ¸
        async function testImageLoading() {
            const testPlaces = ['ë§ˆì¹´ì˜¤êµ­ì œê³µí•­', 'ì•ˆë‹¤ì¦ˆ ë§ˆì¹´ì˜¤', 'ê°¤ëŸ­ì‹œ ë§ˆì¹´ì˜¤'];
            const grid = document.getElementById('image-test-grid');
            
            // ê·¸ë¦¬ë“œ ì´ˆê¸°í™”
            grid.innerHTML = '';
            
            for (const place of testPlaces) {
                const item = document.createElement('div');
                item.className = 'image-test-item';
                item.innerHTML = `
                    <div><span class="status-indicator status-loading"></span>${place}</div>
                    <div class="loading-spinner" style="width: 30px; height: 30px; margin: 20px auto;"></div>
                    <div>ë¡œë”© ì¤‘...</div>
                `;
                grid.appendChild(item);
                
                // ë¹„ë™ê¸°ë¡œ ì´ë¯¸ì§€ ë¡œë“œ í…ŒìŠ¤íŠ¸
                testSinglePlaceImage(place, item);
            }
        }

        async function testSinglePlaceImage(placeName, itemElement) {
            try {
                const result = await placesService.findPlaceByName(placeName);
                
                if (result.photos && result.photos.length > 0) {
                    const photo = result.photos[0];
                    itemElement.innerHTML = `
                        <div><span class="status-indicator status-success"></span>${placeName}</div>
                        <img src="${photo.url}" alt="${placeName}" 
                             onerror="this.parentElement.querySelector('.status-indicator').className='status-indicator status-error'">
                        <div>âœ… ${result.photos.length}ê°œ ì´ë¯¸ì§€</div>
                    `;
                } else {
                    itemElement.innerHTML = `
                        <div><span class="status-indicator status-error"></span>${placeName}</div>
                        <div style="padding: 40px; background: #f3f4f6; border-radius: 6px;">
                            ğŸ“<br>ì´ë¯¸ì§€ ì—†ìŒ
                        </div>
                        <div>âŒ ì´ë¯¸ì§€ ì—†ìŒ</div>
                    `;
                }
            } catch (error) {
                itemElement.innerHTML = `
                    <div><span class="status-indicator status-error"></span>${placeName}</div>
                    <div style="padding: 40px; background: #fef2f2; border-radius: 6px;">
                        âŒ<br>ì˜¤ë¥˜
                    </div>
                    <div>âŒ ${error.message}</div>
                `;
            }
        }

        function clearImageTest() {
            document.getElementById('image-test-grid').innerHTML = '';
        }

        // 4. ì‹¤ì‹œê°„ ì´ë¯¸ì§€ ê°±ì‹  í…ŒìŠ¤íŠ¸
        async function testRealImageSliders() {
            if (typeof imageLoader === 'undefined') {
                alert('Image Loaderê°€ ì´ˆê¸°í™”ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.');
                return;
            }
            
            console.log('ğŸ–¼ï¸ ì‹¤ì‹œê°„ ì´ë¯¸ì§€ ìŠ¬ë¼ì´ë” í…ŒìŠ¤íŠ¸ ì‹œì‘...');
            
            // ë§ˆì¹´ì˜¤ êµ­ì œê³µí•­ í…ŒìŠ¤íŠ¸
            await imageLoader.loadPlaceImages('ë§ˆì¹´ì˜¤êµ­ì œê³µí•­', 'test-slider-airport');
            
            // ì•ˆë‹¤ì¦ˆ ë§ˆì¹´ì˜¤ í…ŒìŠ¤íŠ¸
            setTimeout(async () => {
                await imageLoader.loadPlaceImages('ì•ˆë‹¤ì¦ˆ ë§ˆì¹´ì˜¤', 'test-slider-andaz');
            }, 1000);
        }

        // 5. ì „ì²´ ì‹œìŠ¤í…œ í…ŒìŠ¤íŠ¸
        async function runFullSystemTest() {
            console.log('ğŸš€ ì „ì²´ ì‹œìŠ¤í…œ í…ŒìŠ¤íŠ¸ ì‹œì‘...');
            
            const systemTest = {
                startTime: new Date().toISOString(),
                tests: {}
            };
            
            try {
                // API ì—°ê²° í…ŒìŠ¤íŠ¸
                await testAPIConnection();
                systemTest.tests.apiConnection = testResults['api-test'];
                
                // ì¥ì†Œ ê²€ìƒ‰ í…ŒìŠ¤íŠ¸
                const testPlaces = ['ë§ˆì¹´ì˜¤êµ­ì œê³µí•­', 'ì•ˆë‹¤ì¦ˆ ë§ˆì¹´ì˜¤'];
                for (const place of testPlaces) {
                    await testPlaceSearch(place);
                    await new Promise(resolve => setTimeout(resolve, 500)); // API ì œí•œ ì¤€ìˆ˜
                }
                systemTest.tests.placeSearch = testResults['place-search'];
                
                // ì´ë¯¸ì§€ ë¡œë” í…ŒìŠ¤íŠ¸
                if (typeof imageLoader !== 'undefined') {
                    systemTest.tests.imageLoader = { available: true };
                } else {
                    systemTest.tests.imageLoader = { available: false, error: 'ImageLoader not initialized' };
                }
                
                systemTest.endTime = new Date().toISOString();
                systemTest.duration = Date.now() - new Date(systemTest.startTime).getTime();
                systemTest.success = true;
                
                logResult('system-test', systemTest, true);
                
            } catch (error) {
                systemTest.error = error.message;
                systemTest.success = false;
                logResult('system-test', systemTest, false);
            }
        }

        // ê¸°ë³¸ ìŠ¬ë¼ì´ë” í•¨ìˆ˜ë“¤ (macau.htmlì—ì„œ ì‚¬ìš©í•˜ëŠ” ê²ƒê³¼ ë™ì¼)
        function showSlide(sliderId, index) {
            console.log(`Showing slide ${index} for ${sliderId}`);
        }

        function prevSlide(sliderId) {
            console.log(`Previous slide for ${sliderId}`);
        }

        function nextSlide(sliderId) {
            console.log(`Next slide for ${sliderId}`);
        }

        function openImageModal(src, alt) {
            console.log(`Opening image modal: ${alt}`);
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ìë™ í…ŒìŠ¤íŠ¸
        document.addEventListener('DOMContentLoaded', () => {
            console.log('ğŸ§ª Places API í…ŒìŠ¤íŠ¸ í˜ì´ì§€ ë¡œë“œ ì™„ë£Œ');
            
            // 2ì´ˆ í›„ ìë™ìœ¼ë¡œ API ì—°ê²° í…ŒìŠ¤íŠ¸ ì‹¤í–‰
            setTimeout(() => {
                testAPIConnection();
            }, 2000);
        });
    </script>
</body>
</html>